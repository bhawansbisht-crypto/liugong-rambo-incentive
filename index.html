<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiuGong – RAMBO Incentive Calculator</title>
    <meta name="theme-color" content="#0b5ed7">
    <link rel="manifest" href="/liugong-rambo-incentive/manifest.json">

    <style>
        body { font-family: Arial, Helvetica, sans-serif; margin: 0; background: #f4f6f9; }
        .header { background: #0b5ed7; color: #fff; padding: 10px; display: flex; align-items: center; justify-content: space-between; }
        .header img { height: 40px; background: #fff; padding: 4px; border-radius: 4px; }
        .title { font-weight: bold; font-size: 16px; text-align: center; flex: 1; }
        .container { padding: 16px; max-width: 100%; margin: auto; }
        .card { background: #fff; border-radius: 10px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        th { background: #0b5ed7; color: #fff; position: sticky; top: 0; }
        input { width: 70px; padding: 4px; }
        button { width: 100%; padding: 12px; margin-top: 12px; background: #0b5ed7; color: #fff; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
        button.export { background: #198754; }
        .result { margin-top: 15px; padding: 12px; background: #e9f1ff; border-radius: 8px; font-size: 18px; }
        .footer { text-align: center; font-size: 12px; color: #666; margin-top: 12px; }
    </style>
</head>

<body>

<div class="header">
    <img src="rambo.png" alt="RAMBO">
    <div class="title">LiuGong – RAMBO Incentive Calculator</div>
</div>

<div class="container">
    <div class="card">
        <table>
            <thead>
                <tr>
                    <th>Model</th>
                    <th>Target Taken</th>
                    <th>80% of Target</th>
                    <th>Incentive (₹)</th>
                </tr>
            </thead>
            <tbody id="modelTable"></tbody>
        </table>

        <button onclick="calculateAll()">Calculate Incentive & 80% Target</button>
        <button class="export" onclick="exportToExcel()">Export to Excel</button>

        <div class="result" id="grandResult" style="display:none;">
            <strong>Grand Total Incentive: ₹<span id="grandTotal">0</span></strong>
        </div>

        <div class="result" id="totalMachines" style="display:none;"></div>
    </div>

    <div class="footer">Offline | No Login | For Internal Use Only</div>
</div>

<script>
const modelData = {
    "9030F MINI EXCAVATOR": { cutoff: 3, incentive: 5000 },
    "9040F MINI EXCAVATOR": { cutoff: 3, incentive: 5000 },
    "908E MINI EXCAVATOR": { cutoff: 3, incentive: 8000 },
    "914E EXCAVATOR": { cutoff: 4, incentive: 10000 },
    "915E EXCAVATOR": { cutoff: 4, incentive: 8000 },
    "921i EXCAVATOR": { cutoff: 6, incentive: 10000 },
    "922EXD EXCAVATOR": { cutoff: 6, incentive: 8000 },
    "922EXDLC EXCAVATOR": { cutoff: 6, incentive: 8000 },
    "922EXDLC_800MM FULL MACHINE EXCAVATOR": { cutoff: 6, incentive: 6000 },
    "922EA ALFA EXCAVATOR": { cutoff: 6, incentive: 8000 },
    "924E EXCAVATOR": { cutoff: 6, incentive: 10000 },
    "926E EXCAVATOR": { cutoff: 6, incentive: 12000 },
    "930E EXCAVATOR": { cutoff: 8, incentive: 15000 },
    "939E HD EXCAVATOR": { cutoff: 10, incentive: 20000 }
};

// Build table
const tableBody = document.getElementById('modelTable');

Object.keys(modelData).forEach(model => {
    const safeKey = model.replace(/[^a-zA-Z0-9]/g, '');
    const row = document.createElement('tr');
    row.innerHTML = `
        <td>${model}</td>
        <td><input type="number" min="0" id="qty_${safeKey}" /></td>
        <td id="eighty_${safeKey}">0</td>
        <td id="inc_${safeKey}">0</td>
    `;
    tableBody.appendChild(row);
});

function calculateAll() {
    let grandTotal = 0;
    let totalMachines = 0;

    Object.keys(modelData).forEach(model => {
        const safeKey = model.replace(/[^a-zA-Z0-9]/g, '');
        const qtyInput = document.getElementById(`qty_${safeKey}`);
        const eightyCell = document.getElementById(`eighty_${safeKey}`);
        const incCell = document.getElementById(`inc_${safeKey}`);

        const qty = parseFloat(qtyInput.value) || 0;
        totalMachines += qty;

        if (qty > 0) {
            let eightyPercent = Math.round(qty * 0.8);
            if (eightyPercent < 1) eightyPercent = 1;
            eightyCell.textContent = eightyPercent;

            const cutoff = modelData[model].cutoff;
            const base = modelData[model].incentive;
            const proportionate = base * (qty / cutoff);
            const total = proportionate * qty;

            incCell.textContent = total.toFixed(0);
            grandTotal += total;
        } else {
            eightyCell.textContent = "0";
            incCell.textContent = "0";
        }
    });

    document.getElementById('grandTotal').textContent = grandTotal.toFixed(0);
    document.getElementById('grandResult').style.display = 'block';

    document.getElementById('totalMachines').innerHTML = "<strong>Total Machines: " + totalMachines + "</strong>";
    document.getElementById('totalMachines').style.display = 'block';
}

function exportToExcel() {
    let csv = "Model,Target Taken,80% Target,Incentive\n";

    Object.keys(modelData).forEach(model => {
        const safeKey = model.replace(/[^a-zA-Z0-9]/g, '');
        const qty = document.getElementById(`qty_${safeKey}`).value || 0;
        const eighty = document.getElementById(`eighty_${safeKey}`).textContent || 0;
        const incentive = document.getElementById(`inc_${safeKey}`).textContent || 0;

        csv += `"${model}",${qty},${eighty},${incentive}\n`;
    });

    const totalMachinesText = document.getElementById('totalMachines').innerText.replace("Total Machines: ", "");
    const grandTotalText = document.getElementById('grandTotal').innerText;

    csv += `\nTotal Machines,${totalMachinesText}\n`;
    csv += `Grand Total Incentive,${grandTotalText}\n`;

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);

    const link = document.createElement("a");
    link.setAttribute("href", url);
    link.setAttribute("download", "RAMBO_LiuGong_Incentive_Summary.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

</body>
</html>
