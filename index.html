<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Liugong – RAMBO Incentive Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#0b5ed7"/>
  <link rel="manifest" href="/liugong-rambo-incentive/manifest.json">

  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f4f6f9; }
    header { background:#0b5ed7; color:#fff; padding:12px; text-align:center; font-size:18px; font-weight:bold; }
    .container { padding:10px; }
    table { width:100%; border-collapse:collapse; background:#fff; }
    th, td { border:1px solid #ddd; padding:6px; font-size:13px; text-align:left; }
    th { background:#0b5ed7; color:#fff; position:sticky; top:0; }
    input { width:80px; padding:4px; }
    button { width:100%; padding:12px; margin-top:10px; font-size:16px; border:none; border-radius:6px; cursor:pointer; }
    .calcBtn { background:#0b5ed7; color:#fff; }
    .excelBtn { background:#198754; color:#fff; }
    .result { background:#e9f1ff; padding:10px; margin-top:10px; border-radius:6px; font-size:16px; }
    footer { text-align:center; margin-top:12px; font-size:12px; color:#666; }
  </style>
</head>

<body>

<header>Liugong – RAMBO Incentive Calculator</header>

<div class="container">

  <table>
    <thead>
      <tr>
        <th>Model</th>
        <th>Target Taken</th>
        <th>80% of Target</th>
        <th>Incentive (₹)</th>
      </tr>
    </thead>
    <tbody id="modelTable"></tbody>
  </table>

  <button class="calcBtn" onclick="calculateAll()">Calculate Incentive & 80% Target</button>
  <button class="excelBtn" onclick="exportToExcel()">Export to Excel</button>

  <div class="result" id="totalMachinesBox"><strong>Total Machines: 0</strong></div>
  <div class="result" id="grandTotalBox"><strong>Grand Total Incentive: ₹0</strong></div>

  <footer>Offline | No Login | For Internal Use Only</footer>

</div>

<script>
// =================== MASTER MODEL LIST ===================
const modelData = {
  "9030F MINI EXCAVATOR": {cutoff:3, incentive:3000},
  "9040F MINI EXCAVATOR": {cutoff:3, incentive:4000},
  "908E MINI EXCAVATOR": {cutoff:3, incentive:8000},
  "914E EXCAVATOR": {cutoff:4, incentive:10000},
  "915E EXCAVATOR": {cutoff:4, incentive:8000},
  "921i EXCAVATOR": {cutoff:6, incentive:10000},
  "922EXD EXCAVATOR": {cutoff:6, incentive:8000},
  "922EXDLC EXCAVATOR": {cutoff:6, incentive:8000},
  "922EXDLC_800MM FULL MACHINE EXCAVATOR": {cutoff:6, incentive:6000},
  "922EA ALFA EXCAVATOR": {cutoff:6, incentive:8000},
  "922EALC ALFA EXCAVATOR": {cutoff:4, incentive:8000},
  "922EαLC_Super Structure_Rig Attachment": {cutoff:2, incentive:10000},
  "923EXDLC EXCAVATOR": {cutoff:2, incentive:10000},
  "924EXDLC EXCAVATOR": {cutoff:2, incentive:12000},
  "924EXDLC MECH EXCAVATOR": {cutoff:3, incentive:12000},
  "922EXDLC_800mm_Super Structure ( LR)": {cutoff:12, incentive:10000},
  "925EXLR EXCAVATOR LONG REACH": {cutoff:4, incentive:10000},
  "926EXDLC_800mm_Super Structure EXCAVATOR LONG REACH": {cutoff:2, incentive:15000},
  "930EXLR EXCAVATOR LONG REACH": {cutoff:2, incentive:15000},
  "926EXDLC EXCAVATOR": {cutoff:1, incentive:15000},
  "935EXD EXCAVATOR": {cutoff:1, incentive:15000},
  "939EXD EXCAVATOR": {cutoff:1, incentive:15000},

  "CLG818 WHEEL LOADER": {cutoff:4, incentive:10000},
  "CLG836 WHEEL LOADER": {cutoff:4, incentive:10000},
  "CLG838T MAX WHEEL LOADER": {cutoff:4, incentive:8000},
  "CLG842T MAX WHEEL LOADER": {cutoff:3, incentive:12000},
  "CLG850T MAX. WHEEL LOADER": {cutoff:2, incentive:12000},
  "CLG856T MAX WHEEL LOADER": {cutoff:2, incentive:15000},
  "CLG870H WHEEL LOADER": {cutoff:1, incentive:15000},
  "CLG886H WHEEL LOADER": {cutoff:1, incentive:20000},

  "4100D GRADER": {cutoff:2, incentive:10000},
  "4180D GRADER": {cutoff:2, incentive:10000},
  "6029E BABY TANDEM ROLLER": {cutoff:2, incentive:6000},
  "6611E SOIL COMPACTOR": {cutoff:2, incentive:6000},

  "820TE ELECTRIC 2 TON": {cutoff:4, incentive:20000},
  "838TE ELECTRIC 4 TON": {cutoff:4, incentive:20000},
  "856HE ELCTRIC 6 TON": {cutoff:2, incentive:20000},

  "906FE BATTERY EXCAVATOR 6 TON": {cutoff:1, incentive:15000},
  "908FE CABLE EXCAVATOR 8 TON": {cutoff:1, incentive:15000},
  "922FE CABEL": {cutoff:1, incentive:25000},
  "922FE CABEL + ENGINE ( DUAL POWER)": {cutoff:1, incentive:25000},
  "922FE BATTERY LFP": {cutoff:1, incentive:25000},
  "926FE CABEL": {cutoff:1, incentive:30000},
  "939FE CABEL": {cutoff:1, incentive:25000},
  "950FE CABEL": {cutoff:1, incentive:35000},
  "9650FE DUAL POWER": {cutoff:1, incentive:35000},
  "385BEV SKID LOADER BATTERY ELECTRIC": {cutoff:1, incentive:25000}
};

// =================== BUILD TABLE ===================
const tableBody = document.getElementById("modelTable");

Object.keys(modelData).forEach(model => {
  const safeKey = model.replace(/[^a-zA-Z0-9]/g, "");
  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${model}</td>
    <td><input type="number" min="0" id="qty_${safeKey}" value="0"></td>
    <td id="eighty_${safeKey}">0</td>
    <td id="inc_${safeKey}">0</td>
  `;
  tableBody.appendChild(row);
});

// =================== CORE LOGIC ===================
function calculateAll() {
  let grandTotal = 0;
  let totalMachines = 0;

  Object.keys(modelData).forEach(model => {
    const safeKey = model.replace(/[^a-zA-Z0-9]/g, "");
    const qty = parseFloat(document.getElementById(`qty_${safeKey}`).value) || 0;
    const eightyCell = document.getElementById(`eighty_${safeKey}`);
    const incCell = document.getElementById(`inc_${safeKey}`);

    totalMachines += qty;

    if (qty > 0) {
      // 80% target
      const eighty = Math.max(1, Math.round(qty * 0.8));
      eightyCell.textContent = eighty;

      // Proportionate logic
      const cutoff = modelData[model].cutoff;
      const base = modelData[model].incentive;

      const proportionate = base * (qty / cutoff);
      let total = proportionate * qty;

      // 4x CAP LOGIC
      const maxAllowed = base * 4;
      if (total > maxAllowed) {
        total = maxAllowed;
      }

      incCell.textContent = Math.round(total);
      grandTotal += total;

    } else {
      eightyCell.textContent = 0;
      incCell.textContent = 0;
    }
  });

  document.getElementById("totalMachinesBox").innerHTML = `<strong>Total Machines: ${totalMachines}</strong>`;
  document.getElementById("grandTotalBox").innerHTML = `<strong>Grand Total Incentive: ₹${Math.round(grandTotal)}</strong>`;
}

// =================== EXPORT ===================
function exportToExcel() {
  let csv = "Model,Target Taken,80% of Target,Incentive\n";

  Object.keys(modelData).forEach(model => {
    const safeKey = model.replace(/[^a-zA-Z0-9]/g, "");
    const qty = document.getElementById(`qty_${safeKey}`).value || 0;
    const eighty = document.getElementById(`eighty_${safeKey}`).textContent || 0;
    const inc = document.getElementById(`inc_${safeKey}`).textContent || 0;
    csv += `"${model}",${qty},${eighty},${inc}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "RAMBO_Incentive_Report.csv";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>

</body>
</html>
